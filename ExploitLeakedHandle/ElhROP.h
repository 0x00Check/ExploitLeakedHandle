#pragma once
#include "ElhHelper.h"
#include "ntdll.h"

#pragma comment(lib, "ntdll.lib")

class ElhROP {
public:
    struct ROPVars {
        DWORD64 dwJMPGadget = 0;
        DWORD64 dwMOVGadget = 0;
        DWORD64 dwStackBase = 0;
        std::string sJMPGadget;
        std::string sMOVGadget;
    };

    static bool findGadgets(HMODULE hModule, ROPVars& rVars);
    static void waitThreadAutoLock(HANDLE hThread, CONTEXT& ctx, DWORD64 dwJMPGadget);
    static void gadgetWriteQword(CONTEXT& ctx, HANDLE hThread, DWORD64 dwData, DWORD64 dwAddress, ROPVars& rVars);
    static void gadgetWriteString(CONTEXT& ctx, HANDLE hThread, std::wstring wsData, DWORD64 dwAddress, ROPVars& rVars);
};